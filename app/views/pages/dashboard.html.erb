
<% box_header 'Dashboard' do %>

<div id="update_cache" class='right'>
		<div id='loading_dash' style="display:none;"><%= image_tag('other/loading.gif', :size => '22x22') %></div>
		<span id='load_link' style='display:visible;'><%= link_to_remote "#{image_tag('other/update.png', :id => 'update_image_refresh', :title => 'Update Cache')}", :url => update_cache_path, :loading => "$('#loading_dash').show()", :complete => "$('#loading_dash').hide();document.location.reload()", :html => { :id => 'update_link_refresh' } %></span>
</div>

<%- end -%>

<div id='dashboard' class='sortable'>
	
	<div id="statistics" class='ditem event_data'>
	  <div id="statistics_holder">
	    <div id="dash_table" class='grid_1'>
  		  <div class='table_header top_round'>
  		    Severity Statistics
  		  </div>
  			<div id="dash_table_in" class='hide_event_data'>
  				<table cellspacing="0" cellpadding="0">

  					<thead>
  					 	<tr>
    						<th>Severity</th>
    						<th>Severity Event Count</th>
    					</tr>
  					</thead>

  					<tbody>
  					 	<tr>
    						<td><%= image_tag('severity/high.png', :size=>'10x10') %> High Severity</td>
    						<td><%= link_to "#{pluralize(number_with_delimiter(@high), "Event")}", severity_path(:severity_id => 1) %></td>
    					</tr>

    					<tr>
    						<td><%= image_tag('severity/warn.png', :size=>'10x10') %> Medium Severity</td>
    						<td><%= link_to "#{pluralize(number_with_delimiter(@medium), "Event")}", severity_path(:severity_id => 2) %></td>
    					</tr>

    					<tr>
    						<td><%= image_tag('severity/low.png', :size=>'10x10') %> Low Severity</td>
    						<td><%= link_to "#{pluralize(number_with_delimiter(@low), "Event")}", severity_path(:severity_id => 3) %></td>
    					</tr>
  					</tbody>
  				</table>
  			</div>
  		</div>

  		<div id="dash_table" class='grid_2'>
  		  <div class='table_header top_round'>
  		    <div id="header_options" class='right'>
    		    <%= link_to image_tag('../images/dashboard/hide.png', :size => '16x16'), '#', :item_name => 'event_data', :class => 'd_hide' %>
    		  </div>
  		    Event Statistics
  		  </div>
  			<div id="dash_table_in" class='hide_event_data'>
  				<table cellspacing="0" cellpadding="0">
  					<tr>
  						<th>Event Type</th>
  						<th>Event Count</th>
  					</tr>
  					<tr>
  						<td><%= image_tag('dashboard/box.png', :size=>'10x10') %> Total Event Count:</td>
  						<td><%= pluralize(number_with_delimiter(@events), "Event") %></td>
  					</tr>

  					<tr>
  						<td><%= image_tag('dashboard/box.png', :size=>'10x10') %> Unique Events Types</td>
  						<td><%= pluralize(number_with_delimiter(@uniq_events), "Unique Event Type") %></td>
  					</tr>

  					<tr>
  						<td><%= image_tag('dashboard/box.png', :size=>'10x10') %> Unique Addresses</td>
  						<td><%= pluralize(number_with_delimiter(@uniq_adds), "Unique Address") %></td>
  					</tr>

  				</table>
  			</div>
  		</div>
	  </div>
	</div>
	
	<div id="graph_holder" class='ditem graph_data'>		
    <div class='table_header top_round'>
      <div id="header_options" class='right'>
		    <%= link_to image_tag('../images/dashboard/hide.png', :size => '16x16'), '#', :item_name => 'graph_data', :class => 'd_hide' %>
		  </div>
      Severity Statistics
    </div>
    <div id="graph_holder_frame" class='hide_graph_data'>
      <div id="graph_holder_inside">
        <%- unless @events == 0 -%>
        <table border="0" cellspacing="0" cellpadding="0">
          <tr>
            <th>Event Severity VS Event Count (Pie Chart)</th>
            <th>Event Severity VS Event Count (Bar Chart)</th>
          </tr>
          <tr>
            <td><%= @pie_event_severity %></td>
            <td><%= @bar_event_severity %></td>
          </tr>
        </table>
    		<%- end -%>
      </div>
    </div>
	</div>
	
	<%- unless @comments.blank? or @comments.size >= 5 -%>
	
	<div id="dash_table" class='ditem recent_comments'>
		<div class='table_header top_round'>
		  <div id="header_options" class='right'>
		    <%= link_to image_tag('../images/dashboard/hide.png', :size => '16x16'), '#', :item_name => 'recent_comments', :class => 'd_hide' %>
		  </div>
		  Recent Comments
		</div>
		<div id="dash_table_in" class='hide_recent_comments'>
			<table cellspacing="0" cellpadding="0">
				<tr>
				  <th>Comment Author</th>
					<th>Event Name</th>
					<th>Comment</th>
				</tr>
				  <%- @comments.each do |comment| -%>
				  <tr>
            <td><%= mail_to comment.user.email, comment.user.name %></td>
            <td><%= link_to truncate(comment.event.sig.sig_name, :omission => "...", :length => 50), event_url(comment.event), :title => "#{comment.event.sig.sig_name}" %></td>
            <td><%=h truncate(comment.body, :omission => "...", :length => 50) %></td>
          </tr>
          <%- end -%>
			</table>
		</div>
	</div>
	
	<%- end -%>
	
	<div id="dash_table" class='ditem sensor_data'>
		<div class='table_header top_round'>
		  <div id="header_options" class='right'>
		    <%= link_to image_tag('../images/dashboard/hide.png', :size => '16x16'), '#', :item_name => 'sensor_data', :class => 'd_hide' %>
		  </div>
		  Sensor Information
		</div>
		<div id="dash_table_in" class='hide_sensor_data'>
			<table cellspacing="0" cellpadding="0">
				<tr>
					<th>Sensor</th>
					<th>Hostname</th>
					<th>Interface</th>
					<th>Encoding</th>
					<th>Last Event</th>
					<th>Event Percentage</th>
				</tr>
				<%- @sensors.each do |s, hash_values| -%>
				<tr class="<%= cycle('odd', 'even') %>">
					<td><%= image_tag('dashboard/pill.png', :size=>'12x12') %> <%= @sensors[s][:sensor_id] %></td>
					<td><%= link_to "#{get_address_for_dash?(@sensors[s][:hostname])}", events_for_sensor_path(:sensor => @sensors[s][:sensor_id]) %></td>
					<td><%= @sensors[s][:interface] %></td>
					<td><%= @sensors[s][:encoding] %></td>
					<td><%= @sensors[s][:last_cid] %></td>
					<%- unless @sensors[s][:event_total] == 0 && @events == 0 -%>
					<td><%= horizontal_bar_graph  [["Event Percentage", ((@sensors[s][:event_total]/@events.to_f) * 100).round(2)]] %></td>
					<%- else -%>
					<td><%= horizontal_bar_graph  [["Event Percentage", 0]] %></td>
					<%- end -%>
				</tr>
				<%- end -%>
			</table>
		</div>
	</div>
	
	<div id="dash_table" class='ditem category_data'>
	  <div class='table_header top_round'>
	    <div id="header_options" class='right'>
		    <%= link_to image_tag('../images/dashboard/hide.png', :size => '16x16'), '#', :item_name => 'category_data', :class => 'd_hide' %>
		  </div>
	    Event Category Information
	  </div>
		<div id="dash_table_in" class='hide_category_data'>
			<table cellspacing="0" cellpadding="0">
					<tr>
						<th>Event Category</th>
						<th>Event Count For Category</th>
						<th></th>
						<th></th>
						<th></th>
						<th>Event Percentage</th>
					</tr>
				<tbody>
				<%- @categories.each do |c, hash_values| -%>
				<tr class="<%= cycle('even', 'odd') %>">
					<td><%= image_tag('other/category.png', :size=>'10x10') %> <%= link_to "#{@categories[c][:name]}", category_path(:category_id => @categories[c][:id]) %></td>
					<td><%= pluralize(number_with_delimiter(@categories[c][:event_total]), "Event") %></td>
					<td></td>
					<td></td>
					<td></td>
					<%- unless @categories[c][:event_total] == 0 && @events == 0 -%>
					<td><%= horizontal_bar_graph  [["Event Percentage", ((@categories[c][:event_total]/@events.to_f) * 100).round(2)]] %></td>
					<%- else -%>
					<td><%= horizontal_bar_graph  [["Event Percentage", 0]] %></td>
					<%- end -%>
				</tr>
				<%- end -%>
				</tbody>
			</table>
		</div>
	</div>
	<br />
</div>